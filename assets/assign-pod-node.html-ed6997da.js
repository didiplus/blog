import{ab as t,G as i,H as a,E as e,S as o,N as r,ad as d,W as s}from"./framework-894cff3a.js";const l={},c=e("h1",{id:"将容器组调度到指定的节点",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#将容器组调度到指定的节点","aria-hidden":"true"},"#"),o(" 将容器组调度到指定的节点")],-1),u={href:"https://kubernetes.io/docs/concepts/configuration/assign-pod-node/",target:"_blank",rel:"noopener noreferrer"},p=d('<h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h2><p>在 Kubernetes，您可以限定 Pod 只能在特定的节点上运行，或者优先选择在特定的节点上运行。通常您并不需要这样做，而应该交由 kubernetes 调度程序根据资源使用情况自动地为 Pod 分配节点。但是少数情况下，这种限定仍然是必要的，例如：</p><ul><li>确保某些 Pod 被分配到具有固态硬盘的节点</li><li>将相互通信频繁的两个 Pod 分配到同一个高可用区的节点</li></ul><p>Kubernetes 一共提供了四种方法，可以将 Pod 调度到指定的节点上，这些方法从简便到复杂的顺序如下：</p><ul><li>指定节点 nodeName</li><li>节点选择器 nodeSelector</li><li>Node isolation/restriction</li><li>Affinity and anti-affinity</li></ul><p>本文后续章节逐个描述了他们的用法</p><h2 id="指定节点-nodename" tabindex="-1"><a class="header-anchor" href="#指定节点-nodename" aria-hidden="true">#</a> 指定节点 nodeName</h2><p>nodeName 是四种方法中最简单的一个，但是因为它的局限性，也是使用最少的。nodeName 是 PodSpec 当中的一个字段。如果该字段非空，调度程序直接将其指派到 nodeName 对应的节点上运行。</p><p>通过 nodeName 限定 Pod 所运行的节点有如下局限性：</p><ul><li>如果 nodeName 对应的节点不存在，Pod 将不能运行</li><li>如果 nodeName 对应的节点没有足够的资源，Pod 将运行失败，可能的原因有：OutOfmemory /OutOfcpu</li><li>集群中的 nodeName 通常是变化的（新的集群中可能没有该 nodeName 的节点，指定的 nodeName 的节点可能从集群中移除）</li></ul><h3 id="在-kuboard-中使用-nodename" tabindex="-1"><a class="header-anchor" href="#在-kuboard-中使用-nodename" aria-hidden="true">#</a> 在 Kuboard 中使用 nodeName</h3><p>您在 Kuboard 工作负载编辑器中，可以通过 <em><strong>指定节点</strong></em> --&gt; <em><strong>选择节点</strong></em> 按钮，选择对应 nodeName 的取值。如下图所示：</p><figure><img src="" alt="Kubernetes教程：将容器调度到指定节点-选择节点" tabindex="0" loading="lazy"><figcaption>Kubernetes教程：将容器调度到指定节点-选择节点</figcaption></figure><h2 id="节点选择器-nodeselector" tabindex="-1"><a class="header-anchor" href="#节点选择器-nodeselector" aria-hidden="true">#</a> 节点选择器 nodeSelector</h2><p>nodeSelector 是 PodSpec 中的一个字段。指定了一组名值对。节点的 labels 中必须包含 Pod 的 nodeSelector 中所有的名值对，该节点才可以运行此 Pod。最普遍的用法中， nodeSelector 只包含一个名值对。</p><p>下面的步骤描述了如何在 Kuboard 中使用 nodeSelector</p><h3 id="为节点增加标签-labels" tabindex="-1"><a class="header-anchor" href="#为节点增加标签-labels" aria-hidden="true">#</a> 为节点增加标签 labels</h3><ul><li><p>从 Kuboard <strong>集群概览</strong> 界面进入您选定的节点界面</p></li><li><p>点击 <em><strong>编辑标签</strong></em> 按钮</p><p>增加标签 disk:ssd，并保存，如下图所示：</p><figure><img src="" alt="Kubernetes教程：将容器调度到指定节点-为节点增加标签" tabindex="0" loading="lazy"><figcaption>Kubernetes教程：将容器调度到指定节点-为节点增加标签</figcaption></figure></li></ul><h3 id="为工作负载选择节点" tabindex="-1"><a class="header-anchor" href="#为工作负载选择节点" aria-hidden="true">#</a> 为工作负载选择节点</h3><ul><li><p>在 Kuboard 界面进入工作负载所在的名称空间</p></li><li><p>点击您要编辑的工作负载，进入工作负载查看页</p></li><li><p>点击 <em><strong>编辑</strong></em> 按钮，进入工作负载编辑页，并切换到 <em><strong>高级设置</strong></em> 标签</p></li><li><p>点击 <strong>节点选择</strong> --&gt; <strong>根据标签选择节点</strong> --&gt; <strong>选择标签</strong> 按钮</p><p>选择 <code>disk:ssd</code> 标签，此时可以看到匹配的节点有刚才您添加标签的节点。点击 <em><strong>确定</strong></em> 按钮</p><figure><img src="" alt="Kubernetes教程：将容器调度到指定节点-选择标签" tabindex="0" loading="lazy"><figcaption>Kubernetes教程：将容器调度到指定节点-选择标签</figcaption></figure></li><li><p>点击 <em><strong>保存</strong></em> 按钮</p><p>此时您已完成了通过 nodeSelector 为 Pod 指定节点的任务。</p></li></ul><h2 id="node-isolation-restriction" tabindex="-1"><a class="header-anchor" href="#node-isolation-restriction" aria-hidden="true">#</a> Node isolation/restriction</h2><p>向节点对象添加标签后，可以将 Pod 指定到特定（一个或一组）的节点，以便确保某些 Pod 只在具备某些隔离性、安全性或符合管理规定的节点上运行。如果将标签用于这个目的，推荐选择那些不会被 kubelet 修改的标签。这样做可以避免节点非法使用其 kubelet credential 来设置节点自己的标签，进一步影响到调度器将工作负载调度到该节点上。</p><p><code>NodeRestriction</code> 管理插件可以阻止 kubelet 设置或者修改节点上以 <code>node-restriction.kubernetes.io/</code> 开头的标签。如需要使用该标签前缀作为节点隔离的目的，需要：</p>',23),h={href:"https://kubernetes.io/docs/reference/access-authn-authz/node/",target:"_blank",rel:"noopener noreferrer"},g={href:"https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction",target:"_blank",rel:"noopener noreferrer"},m=e("li",null,[o("添加带 "),e("code",null,"node-restriction.kubernetes.io/"),o(" 前缀的标签到节点对象，并将这些标签作为 Pod 中的节点选择器。例如： "),e("code",null,"example.com.node-restriction.kubernetes.io/fips=true"),o(" 或 "),e("code",null,"example.com.node-restriction.kubernetes.io/pci-dss=true"),o("。")],-1);function b(f,_){const n=s("ExternalLinkIcon");return i(),a("div",null,[c,e("p",null,[o("参考文档： Kubernetes "),e("a",u,[o("Assigning Pods to Nodes"),r(n)])]),p,e("ol",null,[e("li",null,[o("确保 kubenetes 已经启用了 "),e("a",h,[o("Node authorizer"),r(n)]),o(" 和 "),e("a",g,[o("NodeRestriction admission plugin"),r(n)])]),m])])}const k=t(l,[["render",b],["__file","assign-pod-node.html.vue"]]);export{k as default};
